{% extends "base.html" %}
{% block title %}Nova Alocação{% endblock %}
{% block subtitle %}Vincular produto a um cliente{% endblock %}
{% block content %}
<form method="POST" class="space-y-4 max-w-xl">
  <div class="border rounded-xl p-4 bg-white">
    <h3 class="font-medium mb-3">Vincular produto a um cliente</h3>

    <div class="mb-3">
      <label class="block text-sm text-gray-600 mb-1">Cliente</label>
      <select name="cliente_id" class="border rounded px-3 py-2 w-full" required>
        <option value="" disabled selected>Selecione o cliente</option>
        {% for c in clientes %}
          <option value="{{ c.id }}">{{ c.nome }}</option>
        {% endfor %}
      </select>
    </div>

    <div class="mb-3">
      <label class="block text-sm text-gray-600 mb-1">Produto</label>
      <select name="produto_id" class="border rounded px-3 py-2 w-full" required>
        <option value="" disabled selected>Selecione o produto</option>
        {% for p in produtos %}
          <option value="{{ p.id }}">{{ p.nome }}{% if p.classe %} — {{ p.classe }}{% endif %}</option>
        {% endfor %}
      </select>
    </div>

    <!-- ✅ Valor financeiro no lugar do percentual -->
    <div class="mb-3">
      <label class="block text-sm text-gray-600">Valor (R$)</label>
      <input name="valor" type="number" step="0.01" min="0" value="0"
             class="border rounded px-3 py-2 w-40" />
    </div>

    <button class="px-3 py-2 rounded bg-gray-900 text-white text-sm">Cadastrar alocação</button>
  </div>
</form>

{% if not clientes %}
  <div class="mt-4 text-sm text-amber-700 bg-amber-50 border border-amber-200 rounded p-3">
    Nenhum cliente encontrado. Cadastre clientes em <strong>Clientes</strong> ou verifique sua conexão com o Supabase.
  </div>
{% endif %}

{% if not produtos %}
  <div class="mt-2 text-sm text-amber-700 bg-amber-50 border border-amber-200 rounded p-3">
    Nenhum produto encontrado. Crie em <a href="{{ url_for('alocacoes.produtos') }}" class="underline">Alocações &rarr; Produtos</a>.
  </div>
{% endif %}
{% endblock %}
